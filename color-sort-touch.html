<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Color Sort (Touch Fun)</title>
<style>
  body {
    margin:0; height:100vh; display:flex; justify-content:center; align-items:center;
    background:#111; font-family:sans-serif; overflow:hidden; touch-action:manipulation;
  }
  canvas { background:#222; border:2px solid #444; border-radius:10px; touch-action:none; }
  #scoreboard {
    position:fixed; top:10px; right:15px; font-size:22px; background:#0008;
    padding:12px 16px; border-radius:8px; line-height:1.4; color:#fff; font-weight:bold;
    text-align:right;
  }
  /* Moved title, instruction, score 10 lines down */
  #title {
    position:fixed; top:240px; /* moved down */
    left:50%; transform:translateX(-50%);
    font-size:26px; font-weight:bold; color:#fff; text-align:center;
  }
  #instruction {
    position:fixed; top:275px;
    left:50%; transform:translateX(-50%);
    font-size:18px; color:#fff; text-align:center;
  }
  #currentScore {
    position:fixed; top:305px;
    left:50%; transform:translateX(-50%);
    font-size:64px;
    font-weight:bold; color:#ff0; text-align:center;
  }
  #buttons {
    position:fixed; bottom:20px; right:20px; display:flex; flex-direction:column; gap:10px;
  }
  .btn {
    background:#444; color:white; border:none; border-radius:6px; padding:10px 20px;
    font-size:16px; cursor:pointer;
  }
  .btn:hover { background:#666; }
</style>
</head>
<body>
<div id="title">MATCH THE COLOUR</div>
<div id="instruction">Tap 4 corner to score or Dump</div>
<div id="currentScore">Score: 0</div>
<canvas id="game" width="600" height="600"></canvas>
<div id="scoreboard"></div>
<div id="buttons">
  <button class="btn" id="pauseBtn">Pause</button>
  <button class="btn" id="quitBtn">Quit</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const board = document.getElementById('scoreboard');
const currentScoreDiv = document.getElementById('currentScore');
const instruction = document.getElementById('instruction');

const pauseBtn = document.getElementById('pauseBtn');
const quitBtn = document.getElementById('quitBtn');

// Ask for player name
let username = prompt("Name:") || "Player";

// Load high scores
let highScores = JSON.parse(localStorage.getItem("colorSortHighscores") || "{}");
if(!highScores[username]) highScores[username] = 0;

let hsTimer = JSON.parse(localStorage.getItem("colorSortTimer") || "{}");

const colors = ["red","blue","green","yellow","purple","orange","pink","cyan","lime","gold"];
let cornerColors = {};

let score = 0;
let boxSize = 120;
let currentColor = null;
let startTime = Date.now();
let paused = false;

let flashCorner = null;
let flashTime = 200;

// Hide instruction after 10 sec
setTimeout(()=>{ instruction.style.display="none"; }, 10000);

function randomColor(){ return colors[Math.floor(Math.random()*colors.length)]; }

function reshuffleCorners(){
  let chosen = [];
  ["tl","tr","bl","br"].forEach(pos=>{
    let col;
    do { col = randomColor(); } while(chosen.includes(col));
    cornerColors[pos] = col;
    chosen.push(col);
  });
  currentColor = randomColor();
}

function formatTime(ms){
  let totalSec = Math.floor(ms/1000);
  let h = Math.floor(totalSec/3600);
  let m = Math.floor((totalSec%3600)/60);
  let s = totalSec%60;
  return `${h}h ${m}m ${s}s`;
}

function drawBoard(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // corners
  ["tl","tr","bl","br"].forEach(pos=>{
    let x=0, y=0;
    if(pos==="tl"){x=0;y=0;}
    if(pos==="tr"){x=canvas.width-boxSize;y=0;}
    if(pos==="bl"){x=0;y=canvas.height-boxSize;}
    if(pos==="br"){x=canvas.width-boxSize;y=canvas.height-boxSize;}

    ctx.fillStyle = cornerColors[pos];
    ctx.fillRect(x,y,boxSize,boxSize);

    // flash effect
    if(flashCorner===pos){
      ctx.strokeStyle = "white";
      ctx.lineWidth = 5;
      ctx.strokeRect(x+2, y+2, boxSize-4, boxSize-4);
    }
  });

  // dump button
  ctx.fillStyle = "gray";
  ctx.fillRect(canvas.width/2-70, canvas.height-60, 140, 50);
  ctx.fillStyle="white";
  ctx.font="22px sans-serif";
  ctx.textAlign="center";
  ctx.fillText("DUMP", canvas.width/2, canvas.height-28);

  // center block
  ctx.fillStyle=currentColor;
  ctx.fillRect(canvas.width/2-boxSize/2,canvas.height/2-boxSize/2,boxSize,boxSize);

  // dim overlay if paused
  if(paused){
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "white";
    ctx.font="32px sans-serif";
    ctx.textAlign="center";
    ctx.fillText("PAUSED", canvas.width/2, canvas.height/2);
  }
}

function updateScore(change){
  if(paused) return;
  score += change;
  if(score<0) score=0;
  currentScoreDiv.innerText = `Score: ${score}`;

  if(score>highScores[username]) highScores[username]=score;
  localStorage.setItem("colorSortHighscores",JSON.stringify(highScores));

  hsTimer[username] = Date.now()-startTime;
  localStorage.setItem("colorSortTimer",JSON.stringify(hsTimer));

  // highest score among all users
  let maxScore = 0, maxUser = "", maxTime = 0;
  for(const [user,hs] of Object.entries(highScores)){
    if(hs > maxScore){ 
      maxScore = hs; 
      maxUser = user; 
      maxTime = hsTimer[user] || 0;
    }
  }

  let elapsedMs = Date.now() - startTime;
  let formatted = formatTime(elapsedMs);

  board.innerHTML = `<strong>${username}</strong><br>Time: ${formatted}<br>High: ${highScores[username]}<br><hr style="margin:4px 0;border-color:#888"><strong>Top Score: ${maxScore} (${maxUser}) - ${formatTime(maxTime)}</strong>`;
}

function handleTouch(x,y){
  if(paused) return;

  let expected=null;
  for(const [pos,col] of Object.entries(cornerColors)){
    if(col===currentColor) expected=pos;
  }

  let choice=null;
  if(x<boxSize && y<boxSize) choice="tl";
  if(x>canvas.width-boxSize && y<boxSize) choice="tr";
  if(x<boxSize && y>canvas.height-boxSize) choice="bl";
  if(x>canvas.width-boxSize && y>canvas.height-boxSize) choice="br";

  if(choice){
    flashCorner = choice;
    setTimeout(()=>{ flashCorner=null; }, flashTime);
  }

  // dump button
  if(x>canvas.width/2-70 && x<canvas.width/2+70 && y>canvas.height-60){
    if(expected===null){ updateScore(+1); } else { updateScore(-5); }
    reshuffleCorners();
    return;
  }

  if(choice){
    if(choice===expected) updateScore(+10);
    else updateScore(-10);
    reshuffleCorners();
  }
}

canvas.addEventListener("touchstart", e=>{
  e.preventDefault();
  if(paused) return;
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  const x = touch.clientX - rect.left;
  const y = touch.clientY - rect.top;
  handleTouch(x,y);
},{passive:false});

// Pause / Resume button
pauseBtn.addEventListener("click", ()=>{
  paused = !paused;
  pauseBtn.innerText = paused ? "Resume" : "Pause";
});

// Quit button
quitBtn.addEventListener("click", ()=>{
  if(confirm("Are you sure you want to quit?")) location.reload();
});

function loop(){
  drawBoard();
  updateScore(0);
  requestAnimationFrame(loop);
}

reshuffleCorners();
updateScore(0);
loop();
</script>
</body>
</html>